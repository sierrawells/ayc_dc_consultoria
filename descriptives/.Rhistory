strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab",
color = texto),
axis.text.y = element_text(family = "Roboto Slab",
face = "bold",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab",
color = texto),
axis.text.y = element_text(family = "Roboto Slab",
face = "bold",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
axis.text.x = element_blank())
graf_corr_inst_2023
font_add("Roboto Slab",
regular = paste0(font_dir, "RobotoSlab-Regular.ttf"))
font_add("Roboto Slab Bold",
regular = paste0(font_dir, "RobotoSlab-Bold.ttf"))
font_add("Barlow Condensed",
regular = paste0(font_dir, "BarlowCondensed-Regular.ttf"))
font_add("Barlow",
regular = paste0(font_dir, "Barlow-Regular.ttf"))
stopifnot(all(c("Roboto Slab", "Roboto Slab Bold","Barlow Condensed", "Barlow")
%in% font_families()))
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab",
color = texto),
axis.text.y = element_text(family = "Roboto Slab",
face = "bold",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
graf_corr_inst_2023
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab",
color = texto),
axis.text.y = element_text(family = "Roboto Slab Bold",
face = "bold",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
graf_corr_inst_2023
warnings()
for (device in devices){
ggsave(paste0(paths$output, "graf_corr_inst_2023.", device),
plot = graf_corr_inst_2023,
width = 14, height = 8)
walk(paste0(paths$output, "graf_corr_inst_2023.", device),
~add_dclogo(.x, escala = 7))
}
warnings()
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab",
color = texto),
axis.text.y = element_text(family = "Roboto Slab",
face = "bold",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab",
color = texto),
axis.text.y = element_text(family = "Roboto Slab",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
for (device in devices){
ggsave(paste0(paths$output, "graf_corr_inst_2023.", device),
plot = graf_corr_inst_2023,
width = 14, height = 8)
walk(paste0(paths$output, "graf_corr_inst_2023.", device),
~add_dclogo(.x, escala = 7))
}
warnings()
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
graf_corr_inst_2023
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
for (device in devices){
ggsave(paste0(paths$output, "graf_corr_inst_2023.", device),
plot = graf_corr_inst_2023,
width = 14, height = 8)
walk(paste0(paths$output, "graf_corr_inst_2023.", device),
~add_dclogo(.x, escala = 7))
}
warnings()
# Author: SW
# Maintainer(s): SW, AF, PB, IS
# License:  Data Cívica 2024 ©
# ---------------------------------------------
# TODO
# Packages
if(!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, googledrive, ggplot2, ggthemes, scales, here)
# Files
paths <- list(output = here("descriptives/output/"),
tema = here("descriptives/tema.R"))
# Define Drive folders
drive_auth(email = "sierra.wells@datacivica.org")
drive_in_id <- drive_ls(as_id("1-n5ZlkcH1L5naEthn9dGKFOQ7bRunp59")) %>%
pull(id)
stopifnot(length(drive_in_id) == 1)
# READ DATA ====
# Read ENCIG
drive_download(as_id(drive_in_id),
path = paste0(tempdir(), "/encig_clean.csv"),
overwrite = TRUE)
encig <- read_csv(paste0(tempdir(), "/encig_clean.csv"))
file.remove(paste0(tempdir(), "/encig_clean.csv"))
# GRAPH PREP ====
source(paths$tema)
encig_caption <- paste0("Fuente: Elaboración por Data Cívica a partir de la ENCIG 2023",
"\nIntervalos de confianza al 95%")
# PERCEPCIÓN DE CORRUPCIÓN POR INSTITUCIÓN ====
corr_inst_2023 <- encig %>%
filter(year == 2023) %>%
reframe(
across(.cols = starts_with("corr_"),
~ weighted.mean(.x %in% c("Frecuente", "Muy frecuente"),
w = fac_p18, na.rm = TRUE)),
n = n()) %>%
pivot_longer(cols = starts_with("corr_"),
names_to = "inst", values_to = "perc") %>%
mutate(inst = case_when(
inst == "corr_univ_pub" ~ "Universidades públicas",
inst == "corr_policias" ~ "Policías",
inst == "corr_hosp_pub" ~ "Hospitales públicos",
inst == "corr_apf" ~ "Administración pública federal",
inst == "corr_empresarios" ~ "Empresarios",
inst == "corr_gob_est" ~ "Gobierno estatal",
inst == "corr_comp_trab" ~ "Sus compañeros de trabajo",
inst == "corr_gob_mun" ~ "Gobierno municipal",
inst == "corr_parientes" ~ "Sus parientes",
inst == "corr_sindicatos" ~ "Sindicatos",
inst == "corr_vecinos" ~ "Sus vecinos",
inst == "corr_camara_dip_sen" ~ "Cámara de Diputados y Senado",
inst == "corr_medios_com" ~ "Medios de comunicación",
inst == "corr_inst_elect" ~ "Instituciones electorales",
inst == "corr_comis_ddhh" ~ "Comisiones de derechos humanos",
inst == "corr_esc_pub" ~ "Escuelas públicas",
inst == "corr_jueces" ~ "Jueces",
inst == "corr_iglesia" ~ "Iglesias",
inst == "corr_partidos_pol" ~ "Partidos políticos",
inst == "corr_gn" ~ "Guardia Nacional",
inst == "corr_ffaa" ~ "Fuerzas armadas",
inst == "corr_mp_fiscalia" ~ "Ministerio Público y Fiscalías",
inst == "corr_ong" ~ "OSC",
inst == "corr_ocas" ~ "Organismos autónomos públicos"),
margin_error = 1.96 * sqrt((perc * (1 - perc)) / n))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
for (device in devices){
ggsave(paste0(paths$output, "graf_corr_inst_2023.", device),
plot = graf_corr_inst_2023,
width = 14, height = 8)
walk(paste0(paths$output, "graf_corr_inst_2023.", device),
~add_dclogo(.x, escala = 7))
}
warnings()
graf_corr_inst_2023
# TEMA PARA GRÁFICAS ====
tema <- theme(
plot.title = element_text(family = "Barlow Condensed",
face = "bold",
color = texto),
plot.subtitle = element_text(family = "Roboto Slab Bold",
color = texto),
axis.text.y = element_text(family = "Roboto Slab",
color = texto),
axis.text.x = element_text(family = "Barlow",
color = texto),
plot.caption = element_text(family = "Roboto Slab",
color = nota_al_pie,
margin = margin(b = 30)),
plot.caption.position = "plot",
axis.title = element_text(family = "Barlow",
color = texto),
legend.title = element_blank(),
legend.text = element_text(family = "Roboto Slab",
color = texto),
legend.background = element_rect(fill = fondo),
legend.position = "top",
legend.justification='left',
strip.text = element_text(
family = "Barlow Condensed",
face = "bold",
color = "#47423f"),
strip.background = element_rect(fill = fondo),
axis.line = element_line(color = ejes),
axis.ticks = element_line(color = ejes),
panel.background = element_blank(),
panel.grid = element_blank(),
plot.background = element_rect(fill = fondo, color = fondo))
graf_corr_inst_2023 <- ggplot(corr_inst_2023, aes(x = fct_reorder(inst, perc), y = perc)) +
geom_col(aes(fill = inst == "OSC")) +
geom_text(aes(label = percent(perc, accuracy = 0.1)), family = labels_font,
hjust = 1.3, size = 3, fontface = "bold", color = fondo) +
geom_errorbar(aes(ymin = perc - margin_error, ymax = perc + margin_error),
width = 0.2, color = texto) +
coord_flip() +
labs(title = "Percepción de corrupción por institución",
subtitle = "Porcentaje de personas que consideran que la corrupción es frecuente o muy frecuente entre los siguientes actores",
x = "",
y = "",
caption = encig_caption) +
tema +
scale_fill_manual(values = pal) +
theme(legend.position = "none",
axis.text.x = element_blank())
for (device in devices){
ggsave(paste0(paths$output, "graf_corr_inst_2023.", device),
plot = graf_corr_inst_2023,
width = 14, height = 8)
walk(paste0(paths$output, "graf_corr_inst_2023.", device),
~add_dclogo(.x, escala = 7))
}
warnings()
ggsave(paste0(paths$output, "graf_corr_inst_2023.", "pdf"),
plot = graf_corr_inst_2023,
width = 14, height = 8)
load_showtext_fonts()
?font_families
??loadfonts
